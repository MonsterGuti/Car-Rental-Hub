{% extends 'base.html' %}
{% load custom_filters %}

{% block content %}
    <h2 class="mb-4">Dashboard</h2>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Cars</h5>
                    <p class="card-text">{{ total_cars }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">Available Cars</h5>
                    <p class="card-text">{{ available_cars }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3">
                <div class="card-body">
                    <h5 class="card-title">Active Rentals</h5>
                    <p class="card-text">{{ active_rentals }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-body">
                    <h5 class="card-title">Average Rating</h5>
                    <p class="card-text">{{ average_rating|floatformat:1 }} / 5</p>
                </div>
            </div>
        </div>
    </div>

    <h3>Latest Rentals</h3>
    <table class="table table-striped mb-4">
        <thead>
        <tr>
            <th>Car</th>
            <th>Customer</th>
            <th>Start</th>
            <th>End</th>
            <th>Price</th>
        </tr>
        </thead>
        <tbody>
        {% for rental in latest_rentals %}
            <tr>
                <td>{{ rental.car }}</td>
                <td>{{ rental.customer_name }}</td>
                <td>{{ rental.start_date }}</td>
                <td>{{ rental.end_date }}</td>
                <td>{{ rental.total_price }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <h3>Latest Reviews</h3>
    {% for review in latest_reviews %}
        <div class="card mb-2">
            <div class="card-body">
                <strong>{{ review.customer_name }}</strong>
                {% for i in 5|times %}
                    {% if i < review.rating %}
                        <span class="text-warning">&#9733;</span>
                    {% else %}
                        <span class="text-secondary">&#9733;</span>
                    {% endif %}
                {% endfor %}

                <p>{{ review.content }}</p>
                <small class="text-muted">{{ review.created_at|date:"d M Y H:i" }}</small>
            </div>
        </div>
    {% empty %}
        <p>No reviews yet.</p>
    {% endfor %}
{% endblock %}